# 子模块管理说明

## 新增的推送功能

现在项目提供了完整的子模块管理功能，包括自动检测和推送更新。

## 可用脚本

### 1. `更新tts2.bat` - 更新子模块
**功能**：更新 IndexTTS 子模块到最新版本
**特点**：
- 自动检测子模块是否存在
- 支持网络失败时的镜像源
- 更新完成后询问是否推送
- 显示详细的更新状态

**使用方法**：
```bash
更新tts2.bat
```

### 2. `推送子模块TTS2.bat` - 推送更新
**功能**：将子模块更新推送到远程仓库
**特点**：
- 自动检测是否有子模块更新
- 生成详细的提交信息
- 包含子模块提交哈希和时间戳
- 错误处理和状态反馈

**使用方法**：
```bash
推送子模块TTS2.bat
```

### 3. `检查并推送TTS2.bat` - 智能检查推送
**功能**：智能检查子模块状态并推送更新
**特点**：
- 自动检测子模块更新
- 显示更新内容统计
- 交互式确认推送
- 详细的子模块状态显示

**使用方法**：
```bash
检查并推送TTS2.bat
```

## 工作流程

### 场景1：日常更新
```bash
# 1. 更新子模块
更新tts2.bat

# 2. 选择是否推送（脚本会询问）
# 输入 y 推送，其他键跳过
```

### 场景2：仅推送已更新的子模块
```bash
# 直接推送（如果之前已经更新过）
推送子模块TTS2.bat
```

### 场景3：检查并推送
```bash
# 智能检查并推送
检查并推送TTS2.bat
```

## 提交信息格式

推送脚本会自动生成格式化的提交信息：

```
Update IndexTTS submodule

- 更新到最新版本
- 子模块提交: cb5c980 添加新功能
- 更新时间: 2025/01/17 21:30:45
```

## 错误处理

### 常见问题及解决方案

1. **网络连接失败**
   - 脚本会自动尝试镜像源
   - 手动设置：`git config submodule.index-tts.url https://gitee.com/mirrors/index-tts.git`

2. **远程仓库未配置**
   - 错误提示：未配置远程仓库
   - 解决方案：`git remote add origin <your-repo-url>`

3. **推送权限问题**
   - 检查 Git 凭据
   - 确认远程仓库访问权限

4. **子模块未初始化**
   - 自动运行：`git submodule update --init --recursive`

## 最佳实践

### 1. 定期更新
```bash
# 建议每周运行一次
检查并推送TTS2.bat
```

### 2. 团队协作
```bash
# 团队成员拉取项目时
git pull
git submodule update --init --recursive
```

### 3. 版本管理
- 为重要的子模块更新创建标签
- 在提交信息中说明更新原因
- 定期检查子模块状态

### 4. 备份策略
- 定期备份重要配置
- 记录子模块版本变更
- 测试更新后的功能

## 自动化建议

### 设置定时任务
```bash
# Windows 任务计划程序
# 每周自动运行 检查并推送TTS2.bat
```

### CI/CD 集成
```yaml
# GitHub Actions 示例
- name: Update submodule
  run: |
    git submodule update --remote
    git add .gitmodules index-tts
    git commit -m "Auto-update IndexTTS submodule"
    git push
```

## 监控和日志

### 查看子模块状态
```bash
git submodule status
git submodule foreach git log -1 --oneline
```

### 查看更新历史
```bash
git log --oneline --grep="Update IndexTTS submodule"
```

## 注意事项

1. **不要直接修改子模块代码**
2. **推送前先测试功能**
3. **保持提交信息的一致性**
4. **定期清理不需要的更新**
5. **备份重要配置**

通过这些脚本，您可以轻松管理 IndexTTS 子模块的更新和推送，保持项目的同步和一致性。
